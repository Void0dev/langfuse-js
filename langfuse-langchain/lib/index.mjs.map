{"version":3,"file":"index.mjs","sources":["../src/callback.ts"],"sourcesContent":["import { Langfuse, type LangfuseOptions } from \"langfuse\";\n\nimport { BaseCallbackHandler } from \"@langchain/core/callbacks/base\";\nimport {\n  BaseMessage,\n  HumanMessage,\n  ChatMessage,\n  AIMessage,\n  SystemMessage,\n  FunctionMessage,\n  ToolMessage,\n  type BaseMessageFields,\n  type MessageContent,\n} from \"@langchain/core/messages\";\n\nimport type { Serialized } from \"@langchain/core/load/serializable\";\nimport type { AgentAction, AgentFinish } from \"@langchain/core/agents\";\nimport type { ChainValues } from \"@langchain/core/utils/types\";\nimport type { LLMResult } from \"@langchain/core/outputs\";\nimport type { Document } from \"@langchain/core/documents\";\n\nimport type { LangfuseTraceClient, LangfuseSpanClient } from \"langfuse-core\";\n\nexport type LlmMessage = {\n  role: string;\n  content: BaseMessageFields[\"content\"];\n  additional_kwargs?: BaseMessageFields[\"additional_kwargs\"];\n};\n\nexport type AnonymousLlmMessage = {\n  content: BaseMessageFields[\"content\"];\n  additional_kwargs?: BaseMessageFields[\"additional_kwargs\"];\n};\n\ntype RootParams = {\n  root: LangfuseTraceClient | LangfuseSpanClient;\n};\n\ntype KeyParams = {\n  publicKey?: string;\n  secretKey?: string;\n} & LangfuseOptions;\n\ntype ConstructorParams = (RootParams | KeyParams) & {\n  userId?: string; // added to all traces\n  version?: string; // added to all traces and observations\n  sessionId?: string; // added to all traces\n  metadata?: Record<string, unknown>; // added to all traces\n  tags?: string[]; // added to all traces\n};\n\nexport class CallbackHandler extends BaseCallbackHandler {\n  name = \"CallbackHandler\";\n  langfuse: Langfuse;\n  traceId?: string;\n  observationId?: string;\n  rootObservationId?: string;\n  topLevelObservationId?: string;\n  userId?: string;\n  version?: string;\n  sessionId?: string;\n  metadata?: Record<string, unknown>;\n  tags?: string[];\n  rootProvided: boolean = false;\n  debugEnabled: boolean = false;\n  completionStartTimes: Record<string, Date> = {};\n\n  constructor(params?: ConstructorParams) {\n    super();\n    if (params && \"root\" in params) {\n      this.langfuse = params.root.client as Langfuse;\n      this.rootObservationId = params.root.observationId ?? undefined;\n      this.traceId = params.root.traceId;\n      this.rootProvided = true;\n    } else {\n      this.langfuse = new Langfuse({\n        ...params,\n        persistence: \"memory\",\n        sdkIntegration: params?.sdkIntegration ?? \"LANGCHAIN\",\n      });\n      this.sessionId = params?.sessionId;\n      this.userId = params?.userId;\n      this.metadata = params?.metadata;\n      this.tags = params?.tags;\n    }\n    this.version = params?.version;\n  }\n\n  async flushAsync(): Promise<any> {\n    return this.langfuse.flushAsync();\n  }\n\n  async shutdownAsync(): Promise<any> {\n    return this.langfuse.shutdownAsync();\n  }\n\n  debug(enabled: boolean = true): void {\n    this.langfuse.debug(enabled);\n    this.debugEnabled = enabled;\n  }\n\n  _log(message: any): void {\n    if (this.debugEnabled) {\n      console.log(message);\n    }\n  }\n\n  async handleNewToken(_token: string, runId: string): Promise<void> {\n    // if this is the first token, add it to completionStartTimes\n    if (runId && !(runId in this.completionStartTimes)) {\n      this._log(`LLM first streaming token: ${runId}`);\n      this.completionStartTimes[runId] = new Date();\n    }\n    return Promise.resolve();\n  }\n\n  async handleLLMNewToken(\n    token: string,\n    _idx: any,\n    runId: string,\n    _parentRunId?: string,\n    _tags?: string[],\n    _fields?: any\n  ): Promise<void> {\n    // if this is the first token, add it to completionStartTimes\n    if (runId && !(runId in this.completionStartTimes)) {\n      this._log(`LLM first streaming token: ${runId}`);\n      this.completionStartTimes[runId] = new Date();\n    }\n    return Promise.resolve();\n  }\n\n  /**\n   * @deprecated This method will be removed in a future version as it is not concurrency-safe.\n   * Please use interop with the Langfuse SDK to get the trace ID ([docs](https://langfuse.com/docs/integrations/langchain/get-started#interoperability)).\n   */\n  getTraceId(): string | undefined {\n    return this.traceId;\n  }\n\n  /**\n   * @deprecated This method will be removed in a future version as it is not concurrency-safe.\n   * For more information on how to get trace URLs, see {@link https://langfuse.com/docs/tracing/url}.\n   */\n  getTraceUrl(): string | undefined {\n    return this.traceId ? `${this.langfuse.baseUrl}/trace/${this.traceId}` : undefined;\n  }\n\n  getLangchainRunId(): string | undefined {\n    return this.topLevelObservationId;\n  }\n\n  async handleRetrieverError(err: any, runId: string, parentRunId?: string | undefined): Promise<void> {\n    try {\n      this._log(`Retriever error: ${err} with ID: ${runId}`);\n      this.langfuse._updateSpan({\n        id: runId,\n        traceId: this.traceId,\n        level: \"ERROR\",\n        statusMessage: err.toString(),\n        endTime: new Date(),\n        version: this.version,\n      });\n      this.updateTrace(runId, parentRunId, err.toString());\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleChainStart(\n    chain: Serialized,\n    inputs: ChainValues,\n    runId: string,\n    parentRunId?: string | undefined,\n    tags?: string[] | undefined,\n    metadata?: Record<string, unknown> | undefined,\n    runType?: string,\n    name?: string\n  ): Promise<void> {\n    try {\n      this._log(`Chain start with Id: ${runId}`);\n\n      this.generateTrace(chain, runId, parentRunId, tags, metadata, inputs);\n      this.langfuse.span({\n        id: runId,\n        traceId: this.traceId,\n        parentObservationId: parentRunId ?? this.rootObservationId,\n        name: name ?? chain.id.at(-1)?.toString(),\n        metadata: this.joinTagsAndMetaData(tags, metadata),\n        input: inputs,\n        version: this.version,\n      });\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleAgentAction(action: AgentAction, runId?: string, parentRunId?: string): Promise<void> {\n    try {\n      this._log(`Agent action with ID: ${runId}`);\n\n      this.langfuse.span({\n        id: runId,\n        parentObservationId: parentRunId,\n        traceId: this.traceId,\n        endTime: new Date(),\n        input: action,\n        version: this.version,\n      });\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleAgentEnd?(action: AgentFinish, runId: string, parentRunId?: string): Promise<void> {\n    try {\n      this._log(`Agent finish with ID: ${runId}`);\n\n      this.langfuse._updateSpan({\n        id: runId,\n        traceId: this.traceId,\n        endTime: new Date(),\n        output: action,\n        version: this.version,\n      });\n      this.updateTrace(runId, parentRunId, action);\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleChainError(err: any, runId: string, parentRunId?: string | undefined): Promise<void> {\n    try {\n      this._log(`Chain error: ${err} with ID: ${runId}`);\n\n      this.langfuse._updateSpan({\n        id: runId,\n        traceId: this.traceId,\n        level: \"ERROR\",\n        statusMessage: err.toString(),\n        endTime: new Date(),\n        version: this.version,\n      });\n      this.updateTrace(runId, parentRunId, err.toString());\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  generateTrace(\n    serialized: Serialized,\n    runId: string,\n    parentRunId: string | undefined,\n    tags?: string[] | undefined,\n    metadata?: Record<string, unknown> | undefined,\n    input?: string | BaseMessage[][] | ChainValues\n  ): void {\n    if (this.traceId && !parentRunId && !this.rootProvided) {\n      this.traceId = undefined;\n      this.topLevelObservationId = undefined;\n    }\n\n    if (!this.traceId) {\n      this.langfuse.trace({\n        id: runId,\n        name: serialized.id.at(-1)?.toString(),\n        metadata: this.joinTagsAndMetaData(tags, metadata, this.metadata),\n        userId: this.userId,\n        version: this.version,\n        sessionId: this.sessionId,\n        input: input,\n        tags: this.tags,\n      });\n      this.traceId = runId;\n    }\n    this.topLevelObservationId = parentRunId ? this.topLevelObservationId : runId;\n  }\n\n  async handleGenerationStart(\n    llm: Serialized,\n    messages: (LlmMessage | MessageContent | AnonymousLlmMessage)[],\n    runId: string,\n    parentRunId?: string | undefined,\n    extraParams?: Record<string, unknown> | undefined,\n    tags?: string[] | undefined,\n    metadata?: Record<string, unknown> | undefined,\n    name?: string\n  ): Promise<void> {\n    this._log(`Generation start with ID: ${runId}`);\n\n    this.generateTrace(llm, runId, parentRunId, tags, metadata, messages);\n\n    const modelParameters: Record<string, any> = {};\n    const invocationParams = extraParams?.[\"invocation_params\"];\n\n    for (const [key, value] of Object.entries({\n      temperature: (invocationParams as any)?.temperature,\n      max_tokens: (invocationParams as any)?.max_tokens,\n      top_p: (invocationParams as any)?.top_p,\n      frequency_penalty: (invocationParams as any)?.frequency_penalty,\n      presence_penalty: (invocationParams as any)?.presence_penalty,\n      request_timeout: (invocationParams as any)?.request_timeout,\n    })) {\n      if (value !== undefined && value !== null) {\n        modelParameters[key] = value;\n      }\n    }\n\n    interface InvocationParams {\n      _type?: string;\n      model?: string;\n      model_name?: string;\n      repo_id?: string;\n    }\n\n    let extractedModelName: string | undefined;\n    if (extraParams) {\n      const params = extraParams.invocation_params as InvocationParams;\n      extractedModelName = params.model;\n    }\n\n    this.langfuse.generation({\n      id: runId,\n      traceId: this.traceId,\n      name: name ?? llm.id.at(-1)?.toString(),\n      metadata: this.joinTagsAndMetaData(tags, metadata),\n      parentObservationId: parentRunId ?? this.rootObservationId,\n      input: messages,\n      model: extractedModelName,\n      modelParameters: modelParameters,\n      version: this.version,\n    });\n  }\n\n  async handleChatModelStart(\n    llm: Serialized,\n    messages: BaseMessage[][],\n    runId: string,\n    parentRunId?: string | undefined,\n    extraParams?: Record<string, unknown> | undefined,\n    tags?: string[] | undefined,\n    metadata?: Record<string, unknown> | undefined,\n    name?: string\n  ): Promise<void> {\n    try {\n      this._log(`Chat model start with ID: ${runId}`);\n\n      const prompts = messages.flatMap((message) => message.map((m) => this.extractChatMessageContent(m)));\n\n      this.handleGenerationStart(llm, prompts, runId, parentRunId, extraParams, tags, metadata, name);\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleChainEnd(outputs: ChainValues, runId: string, parentRunId?: string | undefined): Promise<void> {\n    try {\n      this._log(`Chain end with ID: ${runId}`);\n\n      this.langfuse._updateSpan({\n        id: runId,\n        traceId: this.traceId,\n        output: outputs,\n        endTime: new Date(),\n        version: this.version,\n      });\n      this.updateTrace(runId, parentRunId, outputs);\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleLLMStart(\n    llm: Serialized,\n    prompts: string[],\n    runId: string,\n    parentRunId?: string | undefined,\n    extraParams?: Record<string, unknown> | undefined,\n    tags?: string[] | undefined,\n    metadata?: Record<string, unknown> | undefined,\n    name?: string\n  ): Promise<void> {\n    try {\n      this._log(`LLM start with ID: ${runId}`);\n\n      this.handleGenerationStart(llm, prompts, runId, parentRunId, extraParams, tags, metadata, name);\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleToolStart(\n    tool: Serialized,\n    input: string,\n    runId: string,\n    parentRunId?: string | undefined,\n    tags?: string[] | undefined,\n    metadata?: Record<string, unknown> | undefined,\n    name?: string\n  ): Promise<void> {\n    try {\n      this._log(`Tool start with ID: ${runId}`);\n\n      this.langfuse.span({\n        id: runId,\n        parentObservationId: parentRunId,\n        traceId: this.traceId,\n        name: name ?? tool.id.at(-1)?.toString(),\n        input: input,\n        metadata: this.joinTagsAndMetaData(tags, metadata),\n        version: this.version,\n      });\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleRetrieverStart(\n    retriever: Serialized,\n    query: string,\n    runId: string,\n    parentRunId?: string | undefined,\n    tags?: string[] | undefined,\n    metadata?: Record<string, unknown> | undefined,\n    name?: string\n  ): Promise<void> {\n    try {\n      this._log(`Retriever start with ID: ${runId}`);\n\n      this.langfuse.span({\n        id: runId,\n        parentObservationId: parentRunId,\n        traceId: this.traceId,\n        name: name ?? retriever.id.at(-1)?.toString(),\n        input: query,\n        metadata: this.joinTagsAndMetaData(tags, metadata),\n        version: this.version,\n      });\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleRetrieverEnd(\n    documents: Document<Record<string, any>>[],\n    runId: string,\n    parentRunId?: string | undefined\n  ): Promise<void> {\n    try {\n      this._log(`Retriever end with ID: ${runId}`);\n\n      this.langfuse._updateSpan({\n        id: runId,\n        traceId: this.traceId,\n        output: documents,\n        endTime: new Date(),\n        version: this.version,\n      });\n      this.updateTrace(runId, parentRunId, documents);\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleToolEnd(output: string, runId: string, parentRunId?: string | undefined): Promise<void> {\n    try {\n      this._log(`Tool end with ID: ${runId}`);\n\n      this.langfuse._updateSpan({\n        id: runId,\n        traceId: this.traceId,\n        output: output,\n        endTime: new Date(),\n        version: this.version,\n      });\n      this.updateTrace(runId, parentRunId, output);\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleToolError(err: any, runId: string, parentRunId?: string | undefined): Promise<void> {\n    try {\n      this._log(`Tool error ${err} with ID: ${runId}`);\n\n      this.langfuse._updateSpan({\n        id: runId,\n        traceId: this.traceId,\n        level: \"ERROR\",\n        statusMessage: err.toString(),\n        endTime: new Date(),\n        version: this.version,\n      });\n      this.updateTrace(runId, parentRunId, err.toString());\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  async handleLLMEnd(output: LLMResult, runId: string, parentRunId?: string | undefined): Promise<void> {\n    try {\n      this._log(`LLM end with ID: ${runId}`);\n\n      const lastResponse =\n        output.generations[output.generations.length - 1][output.generations[output.generations.length - 1].length - 1];\n\n      const llmUsage = output.llmOutput?.[\"tokenUsage\"];\n\n      const extractedOutput =\n        \"message\" in lastResponse && lastResponse[\"message\"] instanceof BaseMessage\n          ? this.extractChatMessageContent(lastResponse[\"message\"])\n          : lastResponse.text;\n\n      this.langfuse._updateGeneration({\n        id: runId,\n        traceId: this.traceId,\n        output: extractedOutput,\n        endTime: new Date(),\n        completionStartTime: runId in this.completionStartTimes ? this.completionStartTimes[runId] : undefined,\n        usage: llmUsage,\n        version: this.version,\n      });\n\n      if (runId in this.completionStartTimes) {\n        delete this.completionStartTimes[runId];\n      }\n\n      this.updateTrace(runId, parentRunId, extractedOutput);\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  private extractChatMessageContent(message: BaseMessage): LlmMessage | AnonymousLlmMessage | MessageContent {\n    let response = undefined;\n\n    if (message instanceof HumanMessage) {\n      response = { content: message.content, role: \"user\" };\n    } else if (message instanceof ChatMessage) {\n      response = { content: message.content, role: message.name };\n    } else if (message instanceof AIMessage) {\n      response = { content: message.content, role: \"assistant\" };\n    } else if (message instanceof SystemMessage) {\n      response = { content: message.content };\n    } else if (message instanceof FunctionMessage) {\n      response = { content: message.content, additional_kwargs: message.additional_kwargs, role: message.name };\n    } else if (message instanceof ToolMessage) {\n      response = { content: message.content, additional_kwargs: message.additional_kwargs, role: message.name };\n    } else if (!message.name) {\n      response = { content: message.content };\n    } else {\n      response = {\n        role: message.name,\n        content: message.content,\n      };\n    }\n    if (message.additional_kwargs.function_call || message.additional_kwargs.tool_calls) {\n      return { ...response, additional_kwargs: message.additional_kwargs };\n    }\n    return response;\n  }\n\n  async handleLLMError(err: any, runId: string, parentRunId?: string | undefined): Promise<void> {\n    try {\n      this._log(`LLM error ${err} with ID: ${runId}`);\n\n      this.langfuse._updateGeneration({\n        id: runId,\n        traceId: this.traceId,\n        level: \"ERROR\",\n        statusMessage: err.toString(),\n        endTime: new Date(),\n        version: this.version,\n      });\n      this.updateTrace(runId, parentRunId, err.toString());\n    } catch (e) {\n      this._log(e);\n    }\n  }\n\n  updateTrace(runId: string, parentRunId: string | undefined, output: any): void {\n    if (!parentRunId && this.traceId && this.traceId === runId) {\n      this.langfuse.trace({ id: this.traceId, output: output });\n    }\n  }\n\n  joinTagsAndMetaData(\n    tags?: string[] | undefined,\n    metadata1?: Record<string, unknown> | undefined,\n    metadata2?: Record<string, unknown> | undefined\n  ): Record<string, unknown> {\n    const finalDict: Record<string, unknown> = {};\n    if (tags && tags.length > 0) {\n      finalDict.tags = tags;\n    }\n    if (metadata1) {\n      Object.assign(finalDict, metadata1);\n    }\n    if (metadata2) {\n      Object.assign(finalDict, metadata2);\n    }\n    return finalDict;\n  }\n}\n"],"names":["CallbackHandler","BaseCallbackHandler","constructor","params","name","rootProvided","debugEnabled","completionStartTimes","langfuse","root","client","rootObservationId","observationId","undefined","traceId","Langfuse","persistence","sdkIntegration","sessionId","userId","metadata","tags","version","flushAsync","shutdownAsync","debug","enabled","_log","message","console","log","handleNewToken","_token","runId","Date","Promise","resolve","handleLLMNewToken","token","_idx","_parentRunId","_tags","_fields","getTraceId","getTraceUrl","baseUrl","getLangchainRunId","topLevelObservationId","handleRetrieverError","err","parentRunId","_updateSpan","id","level","statusMessage","toString","endTime","updateTrace","e","handleChainStart","chain","inputs","runType","generateTrace","span","parentObservationId","at","joinTagsAndMetaData","input","handleAgentAction","action","handleAgentEnd","output","handleChainError","serialized","trace","handleGenerationStart","llm","messages","extraParams","modelParameters","invocationParams","key","value","Object","entries","temperature","max_tokens","top_p","frequency_penalty","presence_penalty","request_timeout","extractedModelName","invocation_params","model","generation","handleChatModelStart","prompts","flatMap","map","m","extractChatMessageContent","handleChainEnd","outputs","handleLLMStart","handleToolStart","tool","handleRetrieverStart","retriever","query","handleRetrieverEnd","documents","handleToolEnd","handleToolError","handleLLMEnd","lastResponse","generations","length","llmUsage","llmOutput","extractedOutput","BaseMessage","text","_updateGeneration","completionStartTime","usage","response","HumanMessage","content","role","ChatMessage","AIMessage","SystemMessage","FunctionMessage","additional_kwargs","ToolMessage","function_call","tool_calls","handleLLMError","metadata1","metadata2","finalDict","assign"],"mappings":"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"}